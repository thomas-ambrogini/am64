<!-- HTML header for doxygen 1.8.11-->
<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN" "http://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd">
<html xmlns="http://www.w3.org/1999/xhtml">
<head>
<link rel="shortcut icon" href="favicon.png" type="image/png">    
<meta http-equiv="Content-Type" content="text/xhtml;charset=UTF-8"/>
<meta http-equiv="X-UA-Compatible" content="IE=9"/>
<meta name="generator" content="Doxygen 1.8.20"/>
<title>AM64x MCU+ SDK: HSR_PRP Demo</title>
<link href="tabs.css" rel="stylesheet" type="text/css"/>
<script type="text/javascript" src="jquery.js"></script>
<script type="text/javascript" src="dynsections.js"></script>
<style>
.tinav {
    background: #c00;
    /* height: 41.375px; */
    height: 30px;
    }
</style>    
<link href="navtree.css" rel="stylesheet" type="text/css"/>
<script type="text/javascript" src="resize.js"></script>
<script type="text/javascript" src="navtreedata.js"></script>
<script type="text/javascript" src="navtree.js"></script>
<link href="search/search.css" rel="stylesheet" type="text/css"/>
<script type="text/javascript" src="search/searchdata.js"></script>
<script type="text/javascript" src="search/search.js"></script>
<script type="text/javascript">
/* @license magnet:?xt=urn:btih:cf05388f2679ee054f2beb29a391d25f4e673ac3&amp;dn=gpl-2.0.txt GPL-v2 */
  $(document).ready(function() { init_search(); });
/* @license-end */
</script>
<link href="doxygen.css" rel="stylesheet" type="text/css" />
<link href="stylesheet.css" rel="stylesheet" type="text/css"/>
</head>
<body>
<div id="top"><!-- do not remove this div, it is closed by doxygen! -->
<div id="titlearea">
<table cellspacing="0" cellpadding="0">
 <tbody>
 <tr style="height: 40px;">
  <td id="projectlogo"><a href="https://www.ti.com"><img alt="Logo" src="ti_logo.svg"/></a></td>
  <td id="projectalign" style="padding-left: 0.5em;">
   <div id="projectname">AM64x MCU+ SDK
   &#160;<span id="projectnumber">08.05.00</span>
   </div>
  </td>
   <td>        <div id="MSearchBox" class="MSearchBoxInactive">
        <span class="left">
          <img id="MSearchSelect" src="search/mag_sel.svg"
               onmouseover="return searchBox.OnSearchSelectShow()"
               onmouseout="return searchBox.OnSearchSelectHide()"
               alt=""/>
          <input type="text" id="MSearchField" value="Search" accesskey="S"
               onfocus="searchBox.OnSearchFieldFocus(true)" 
               onblur="searchBox.OnSearchFieldFocus(false)" 
               onkeyup="searchBox.OnSearchFieldChange(event)"/>
          </span><span class="right">
            <a id="MSearchClose" href="javascript:searchBox.CloseResultsWindow()"><img id="MSearchCloseImg" border="0" src="search/close.svg" alt=""/></a>
          </span>
        </div>
</td>
 </tr>
 </tbody>
</table>
<div class=tinav></div>
</div>
<!-- end header part -->
<!-- Generated by Doxygen 1.8.20 -->
<script type="text/javascript">
/* @license magnet:?xt=urn:btih:cf05388f2679ee054f2beb29a391d25f4e673ac3&amp;dn=gpl-2.0.txt GPL-v2 */
var searchBox = new SearchBox("searchBox", "search",false,'Search');
/* @license-end */
</script>
</div><!-- top -->
<div id="side-nav" class="ui-resizable side-nav-resizable">
  <div id="nav-tree">
    <div id="nav-tree-contents">
      <div id="nav-sync" class="sync"></div>
    </div>
  </div>
  <div id="splitbar" style="-moz-user-select:none;" 
       class="ui-resizable-handle">
  </div>
</div>
<script type="text/javascript">
/* @license magnet:?xt=urn:btih:cf05388f2679ee054f2beb29a391d25f4e673ac3&amp;dn=gpl-2.0.txt GPL-v2 */
$(document).ready(function(){initNavTree('EXAMPLES_INDUSTRIAL_COMMS_HSR_PRP_DEMOS.html',''); initResizable(); });
/* @license-end */
</script>
<div id="doc-content">
<!-- window showing the filter options -->
<div id="MSearchSelectWindow"
     onmouseover="return searchBox.OnSearchSelectShow()"
     onmouseout="return searchBox.OnSearchSelectHide()"
     onkeydown="return searchBox.OnSearchSelectKey(event)">
</div>

<!-- iframe showing the search results (closed by default) -->
<div id="MSearchResultsWindow">
<iframe src="javascript:void(0)" frameborder="0" 
        name="MSearchResults" id="MSearchResults">
</iframe>
</div>

<div class="PageDoc"><div class="header">
  <div class="headertitle">
<div class="title">HSR_PRP Demo </div>  </div>
</div><!--header-->
<div class="contents">
<div class="toc"><h3>Table of Contents</h3>
<ul><li class="level1"><a href="#autotoc_md1975">Introduction</a></li>
<li class="level1"><a href="#autotoc_md1976">Supported Combinations</a></li>
<li class="level1"><a href="#autotoc_md1977">Steps to Run the Example</a><ul><li class="level2"><a href="#autotoc_md1978">Build the example</a></li>
<li class="level2"><a href="#autotoc_md1979">HW Setup</a><ul><li class="level3"><a href="#autotoc_md1980">AM64X-EVM</a></li>
</ul>
</li>
<li class="level2"><a href="#autotoc_md1981">Run the example</a></li>
<li class="level2"><a href="#autotoc_md1982">UART Menu</a><ul><li class="level3"><a href="#autotoc_md1983">Sample Output</a></li>
</ul>
</li>
<li class="level2"><a href="#autotoc_md1984">IP Configuration</a></li>
<li class="level2"><a href="#autotoc_md1985">Communicate with the EVM using ethernet</a></li>
<li class="level2"><a href="#autotoc_md1986">Troubleshooting issues</a></li>
</ul>
</li>
<li class="level1"><a href="#autotoc_md1987">See Also</a></li>
</ul>
</div>
<div class="textblock"><p><a class="anchor" id="md_examples_industrial_comms_hsr_prp_demo"></a></p>
<h1><a class="anchor" id="autotoc_md1975"></a>
Introduction</h1>
<p>The example is an HSR/PRP (High Availability Seamless Redundanc/Parallel Redundancy Protocol) Dual Attached Node demo application using LwIP stack.HSR and PRP are actually two separate examples which are available in the same package. They use the same files and based on the defined MACRO the application is taken. HSR and PRP are zero downtime industrial redundancy protocol that operate at Layer 2 and use commercial off-the-shelf Ethernet communication chips and physical media.HSR has a header attached to it that makes it incompatible with standard switches and routers but PRP can be supported using traditional switches, PRP has trailer attached to standard ethernet frames and can be supported using traditional switches. HSR and PRP is mainly used in the substation automation market and the target applications use IEC 61850 protocols. This application does not provide any IEC 61850 integrated examples but itâ€™s easy to integrate one given the transparent nature of HSR/PRP implementation.</p><ul>
<li>The implementation consists of<ul>
<li>Firmware (provided as a binary)</li>
<li><a class="el" href="ICSS_EMAC.html">ICSS-EMAC</a> (Ethernet Driver)</li>
<li>LwIP TCP/IP networking stack with SNMP support on top of ethernet driver</li>
<li><a class="el" href="HSR_PRP_FWHAL.html">HSR_PRP(High-availability seamless Redundancy/Parallel Redundancy Protocol) FWHAL</a></li>
<li>Application</li>
</ul>
</li>
</ul>
<dl class="section note"><dt>Note</dt><dd>The work-around for issue "i2329 - MDIO: MDIO interface corruption (CPSW and PRU-ICSS)" (described in <a href="https://www.ti.com/lit/er/sprz457e/sprz457e.pdf">AM64x/AM243x Processor Silicon Revision 1.0, 2.0 (Rev. E)</a>) is available in this release. Please see <a class="el" href="INDUSTRIAL_COMMS_MDIO_MANUALMODE_FW_USAGE.html">PRU-ICSS Firmware for MDIO Manual Mode</a> for more details.</dd></dl>
<h1><a class="anchor" id="autotoc_md1976"></a>
Supported Combinations</h1>
<table class="markdownTable">
<tr class="markdownTableHead">
<th class="markdownTableHeadNone">Parameter  </th><th class="markdownTableHeadNone">Value   </th></tr>
<tr class="markdownTableRowOdd">
<td class="markdownTableBodyNone">CPU + OS  </td><td class="markdownTableBodyNone">r5fss0-0_freertos   </td></tr>
<tr class="markdownTableRowEven">
<td class="markdownTableBodyNone">ICSSG  </td><td class="markdownTableBodyNone">ICSSG1   </td></tr>
<tr class="markdownTableRowOdd">
<td class="markdownTableBodyNone">Toolchain  </td><td class="markdownTableBodyNone">ti-arm-clang   </td></tr>
<tr class="markdownTableRowEven">
<td class="markdownTableBodyNone">Board  </td><td class="markdownTableBodyNone">am64x-evm   </td></tr>
<tr class="markdownTableRowOdd">
<td class="markdownTableBodyNone">Example folder  </td><td class="markdownTableBodyNone">examples/industrial_comms/hsr_prp_demo   </td></tr>
</table>
<h1><a class="anchor" id="autotoc_md1977"></a>
Steps to Run the Example</h1>
<h2><a class="anchor" id="autotoc_md1978"></a>
Build the example</h2>
<ul>
<li>When using CCS projects to build, import the CCS project for the required combination and build it using the CCS project menu (see <a class="el" href="CCS_PROJECTS_PAGE.html">Using SDK with CCS Projects</a>).</li>
<li>When using makefiles to build, note the required combination and build using make command (see <a class="el" href="MAKEFILE_BUILD_PAGE.html">Using SDK with Makefiles</a>)</li>
</ul>
<h2><a class="anchor" id="autotoc_md1979"></a>
HW Setup</h2>
<dl class="section note"><dt>Note</dt><dd>Make sure you have setup the EVM with cable connections as shown here, <a class="el" href="EVM_SETUP_PAGE.html">EVM Setup</a>. In addition do below steps.</dd></dl>
<h3><a class="anchor" id="autotoc_md1980"></a>
AM64X-EVM</h3>
<ul>
<li>Connect a ethernet cable to the EVM from host PC as shown below</li>
</ul>
<p> <style>div.image img[src="am64x_evm_lwip_example_01.png"]{width:30%}</style> </p><div class="image">
<img src="am64x_evm_lwip_example_01.png" alt=""/>
<div class="caption">
Ethernet cable for ICSS based ethernet</div></div>
<h2><a class="anchor" id="autotoc_md1981"></a>
Run the example</h2>
<dl class="section attention"><dt>Attention</dt><dd>If you need to reload and run the example again, EVM power-cycle is MUST.</dd></dl>
<ul>
<li>Launch a CCS debug session and run the example executable, see <a class="el" href="CCS_LAUNCH_PAGE.html">CCS Launch, Load and Run</a></li>
<li>You will see logs in the UART terminal as shown in the next section.</li>
<li>Note the IP address seen in the log, this is what we will use to communicate with the EVM.</li>
</ul>
<dl class="section note"><dt>Note</dt><dd>HSR/PRP RGMII example not tested.</dd></dl>
<h2><a class="anchor" id="autotoc_md1982"></a>
UART Menu</h2>
<ul>
<li>The application has a built in UART console menu. It allows the user to perform the following tasks :<ul>
<li>View HSR/PRP statistics - Allows user to see number of packets forwarded to host, number of duplicates, number of packets transmitted by the host to the LRE (Link Redundancy Entity).</li>
<li>View HSR/PRP LRE statistics - Allows user to see the stats reported by LRE (Link Redundancy Entity).</li>
<li>View HSR/PRP Configuration - Allows user to see the configuration</li>
<li>View HSR/PRP Node Table - User can see the node table contents which keeps a track of all devices on the network which send HSR/PRP Supervision frames. Device MAC ID, table entry index can be viewed.</li>
<li>Configure Multicast filter - User can configure the multicast filtering support using a UART driven submenu.</li>
<li>Configure VLAN filter - User can configure the VLAN filtering support using a UART driven submenu.</li>
<li>Assign an IP address - The IP address is stored at a fixed location in SPI flash at the offset defined by SPI_EEPROM_DEVICEIP_OFFSET. This IP address is taken at startup and user can also change the IP address</li>
<li>View PTP status - Shows basic PTP/1588 parameters like peer delay, clock jitter, absolute time and port on which receiver is connected. All values are in nanoseconds wherever applicable.</li>
<li>Print CPU Load - Prints CPU load on the UART console</li>
<li>Configure storm prevention - User can configure(enable/disable) the storm prevention and set the credits indivdually for UC, BC and MC traffic.</li>
</ul>
</li>
</ul>
<h3><a class="anchor" id="autotoc_md1983"></a>
Sample Output</h3>
<div class="fragment"><div class="line">HSR Application</div>
<div class="line">Starting lwIP, local interface IP is 192.168.2.12</div>
<div class="line">[LWIPIF_LWIP]Link is down[LWIPIF_LWIP] Interface layer handle is Initialised</div>
<div class="line">[LWIPIF_LWIP] NETIF INIT SUCCESS</div>
<div class="line">status_callback==UP, local interface IP is 192.168.2.12</div>
<div class="line">UDP server listening on port 5001</div>
<div class="line"> </div>
<div class="line">HSR Sample application running</div>
<div class="line">Assigned IP     : 192.168.2.12</div>
<div class="line">Mac Id          : 70:ff:76:1d:ec:f6</div>
<div class="line"> </div>
<div class="line">IP Address      : 192.168.2.12</div>
<div class="line">Device config   : HSR MODE H</div>
<div class="line"> </div>
<div class="line">HSR/PRP Application Menu Options. Press key (Upper/Lower)</div>
<div class="line">*******************************************</div>
<div class="line">S : Show Statistics</div>
<div class="line">L : Show LRE Statistics</div>
<div class="line">C : Show HSR/PRP Configuration</div>
<div class="line">N : Show Ring members/Node Table</div>
<div class="line">M : Multicast filter handling</div>
<div class="line">V : VLAN filter handling</div>
<div class="line">E : Print CPU Load</div>
<div class="line">I : Assign IP address</div>
<div class="line">P : Show PTP/1588 status</div>
<div class="line">R : Run Rx/Tx test</div>
<div class="line">X : To perform DUT side settings</div>
<div class="line">H : Help menu. Shows details on all the options</div>
<div class="line">********************************************</div>
<div class="line">link_callback==UP</div>
<div class="line"> </div>
<div class="line">PRP Application</div>
<div class="line">Mode: MII</div>
<div class="line">Starting lwIP, local interface IP is 192.168.1.10</div>
<div class="line">[LWIPIF_LWIP] Interface layer handle is Initialised</div>
<div class="line">[LWIPIF_LWIP] NETIF INIT SUCCESS</div>
<div class="line">status_callback==UP, local interface IP is 192.168.1.10</div>
<div class="line"> </div>
<div class="line">PRP Sample application running</div>
<div class="line">Assigned IP     : 192.168.1.10</div>
<div class="line">Mac Id          : 70:ff:76:1e:30:5c</div>
<div class="line"> </div>
<div class="line"> </div>
<div class="line">HSR/PRP Application Menu Options. Press key (Upper/Lower)</div>
<div class="line">*******************************************</div>
<div class="line">S : Show Statistics</div>
<div class="line">L : Show LRE Statistics</div>
<div class="line">C : Show PRP Configuration</div>
<div class="line">N : Show Ring members/Node Table</div>
<div class="line">M : Multicast filter handling</div>
<div class="line">V : VLAN filter handling</div>
<div class="line">E : Print CPU Load</div>
<div class="line">I : Assign IP address</div>
<div class="line">P : Show PTP/1588 status</div>
<div class="line">R : Run Rx/Tx test</div>
<div class="line">X : To perform DUT side settings</div>
<div class="line">H : Help menu. Shows details on all the options</div>
<div class="line">********************************************</div>
<div class="line">link_callback==UP</div>
</div><!-- fragment --><h2><a class="anchor" id="autotoc_md1984"></a>
IP Configuration</h2>
<ul>
<li>The example starts off with stack being initialised with a &#160;static IP stored in EEPROM or from default IP in application code. The HSR/PRP UART menu gives user ability to change IP Address via terminal using steps mentioned below.</li>
</ul>
<div class="fragment"><div class="line">HSR/PRP Application Menu Options. Press key (Upper/Lower)</div>
<div class="line">*******************************************</div>
<div class="line">S : Show Statistics</div>
<div class="line">L : Show LRE Statistics</div>
<div class="line">C : Show PRP Configuration</div>
<div class="line">N : Show Ring members/Node Table</div>
<div class="line">M : Multicast filter handling</div>
<div class="line">V : VLAN filter handling</div>
<div class="line">E : Print CPU Load</div>
<div class="line">I : Assign IP address</div>
<div class="line">P : Show PTP/1588 status</div>
<div class="line">R : Run Rx/Tx test</div>
<div class="line">X : To perform DUT side settings</div>
<div class="line">H : Help menu. Shows details on all the options</div>
<div class="line">********************************************</div>
<div class="line">i</div>
<div class="line"> </div>
<div class="line">Type IP Address and hit Enter:  192.168.1.11</div>
<div class="line"> </div>
<div class="line">Successfully assigned new IP address</div>
<div class="line">Assign IP address...completed</div>
<div class="line"> </div>
<div class="line"> </div>
<div class="line"> </div>
<div class="line">IP Address      : 192.168.1.11</div>
<div class="line">Device config   : PRP</div>
</div><!-- fragment --><h2><a class="anchor" id="autotoc_md1985"></a>
Communicate with the EVM using ethernet</h2>
<ul>
<li>Firstly you can try to reach the EVM using ping as shown below, using a command shell on the host PC <pre class="fragment">  &gt; ping 192.168.1.10
</pre></li>
</ul>
<h2><a class="anchor" id="autotoc_md1986"></a>
Troubleshooting issues</h2>
<ul>
<li>If you see a valid MAC address and address and <code>link_callback==DOWN</code> is seen then<ul>
<li>check the ethernet cable if it is properly connected</li>
</ul>
</li>
</ul>
<h1><a class="anchor" id="autotoc_md1987"></a>
See Also</h1>
<p><a class="el" href="HSR_PRP_FWHAL.html">HSR_PRP(High-availability seamless Redundancy/Parallel Redundancy Protocol) FWHAL</a> </p>
</div></div><!-- contents -->
</div><!-- PageDoc -->
</div><!-- doc-content -->
<!-- HTML footer for doxygen 1.8.11-->
<!-- start footer part -->
<div id="nav-path" class="navpath"><!-- id is needed for treeview function! -->
  <ul>
    <li class="footer">generated by
    <a href="http://www.doxygen.org/index.html">
    <img class="footer" src="doxygen.png" alt="doxygen"/></a> 1.8.20 </li>
  </ul>
</div>
</body>
</html>
