<!-- HTML header for doxygen 1.8.11-->
<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN" "http://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd">
<html xmlns="http://www.w3.org/1999/xhtml">
<head>
<link rel="shortcut icon" href="favicon.png" type="image/png">    
<meta http-equiv="Content-Type" content="text/xhtml;charset=UTF-8"/>
<meta http-equiv="X-UA-Compatible" content="IE=9"/>
<meta name="generator" content="Doxygen 1.8.20"/>
<title>AM64x MCU+ SDK: TAMAGAWA Diagnostic</title>
<link href="tabs.css" rel="stylesheet" type="text/css"/>
<script type="text/javascript" src="jquery.js"></script>
<script type="text/javascript" src="dynsections.js"></script>
<style>
.tinav {
    background: #c00;
    /* height: 41.375px; */
    height: 30px;
    }
</style>    
<link href="navtree.css" rel="stylesheet" type="text/css"/>
<script type="text/javascript" src="resize.js"></script>
<script type="text/javascript" src="navtreedata.js"></script>
<script type="text/javascript" src="navtree.js"></script>
<link href="search/search.css" rel="stylesheet" type="text/css"/>
<script type="text/javascript" src="search/searchdata.js"></script>
<script type="text/javascript" src="search/search.js"></script>
<script type="text/javascript">
/* @license magnet:?xt=urn:btih:cf05388f2679ee054f2beb29a391d25f4e673ac3&amp;dn=gpl-2.0.txt GPL-v2 */
  $(document).ready(function() { init_search(); });
/* @license-end */
</script>
<link href="doxygen.css" rel="stylesheet" type="text/css" />
<link href="stylesheet.css" rel="stylesheet" type="text/css"/>
</head>
<body>
<div id="top"><!-- do not remove this div, it is closed by doxygen! -->
<div id="titlearea">
<table cellspacing="0" cellpadding="0">
 <tbody>
 <tr style="height: 40px;">
  <td id="projectlogo"><a href="https://www.ti.com"><img alt="Logo" src="ti_logo.svg"/></a></td>
  <td id="projectalign" style="padding-left: 0.5em;">
   <div id="projectname">AM64x MCU+ SDK
   &#160;<span id="projectnumber">08.05.00</span>
   </div>
  </td>
   <td>        <div id="MSearchBox" class="MSearchBoxInactive">
        <span class="left">
          <img id="MSearchSelect" src="search/mag_sel.svg"
               onmouseover="return searchBox.OnSearchSelectShow()"
               onmouseout="return searchBox.OnSearchSelectHide()"
               alt=""/>
          <input type="text" id="MSearchField" value="Search" accesskey="S"
               onfocus="searchBox.OnSearchFieldFocus(true)" 
               onblur="searchBox.OnSearchFieldFocus(false)" 
               onkeyup="searchBox.OnSearchFieldChange(event)"/>
          </span><span class="right">
            <a id="MSearchClose" href="javascript:searchBox.CloseResultsWindow()"><img id="MSearchCloseImg" border="0" src="search/close.svg" alt=""/></a>
          </span>
        </div>
</td>
 </tr>
 </tbody>
</table>
<div class=tinav></div>
</div>
<!-- end header part -->
<!-- Generated by Doxygen 1.8.20 -->
<script type="text/javascript">
/* @license magnet:?xt=urn:btih:cf05388f2679ee054f2beb29a391d25f4e673ac3&amp;dn=gpl-2.0.txt GPL-v2 */
var searchBox = new SearchBox("searchBox", "search",false,'Search');
/* @license-end */
</script>
</div><!-- top -->
<div id="side-nav" class="ui-resizable side-nav-resizable">
  <div id="nav-tree">
    <div id="nav-tree-contents">
      <div id="nav-sync" class="sync"></div>
    </div>
  </div>
  <div id="splitbar" style="-moz-user-select:none;" 
       class="ui-resizable-handle">
  </div>
</div>
<script type="text/javascript">
/* @license magnet:?xt=urn:btih:cf05388f2679ee054f2beb29a391d25f4e673ac3&amp;dn=gpl-2.0.txt GPL-v2 */
$(document).ready(function(){initNavTree('EXAMPLE_MOTORCONTROL_TAMAGAWA.html',''); initResizable(); });
/* @license-end */
</script>
<div id="doc-content">
<!-- window showing the filter options -->
<div id="MSearchSelectWindow"
     onmouseover="return searchBox.OnSearchSelectShow()"
     onmouseout="return searchBox.OnSearchSelectHide()"
     onkeydown="return searchBox.OnSearchSelectKey(event)">
</div>

<!-- iframe showing the search results (closed by default) -->
<div id="MSearchResultsWindow">
<iframe src="javascript:void(0)" frameborder="0" 
        name="MSearchResults" id="MSearchResults">
</iframe>
</div>

<div class="PageDoc"><div class="header">
  <div class="headertitle">
<div class="title">TAMAGAWA Diagnostic </div>  </div>
</div><!--header-->
<div class="contents">
<div class="toc"><h3>Table of Contents</h3>
<ul><li class="level1"><a href="#autotoc_md1381">Introduction</a></li>
<li class="level1"><a href="#autotoc_md1382">Important files and directory structure</a></li>
<li class="level1"><a href="#EXAMPLES_MOTORCONTROL_TAMAGAWA_COMBOS">Supported Combinations</a></li>
<li class="level1"><a href="#autotoc_md1383">Steps to Run the Example</a><ul><li class="level2"><a href="#autotoc_md1384">Hardware Prerequisites</a></li>
<li class="level2"><a href="#autotoc_md1385">Hardware Setup</a></li>
<li class="level2"><a href="#autotoc_md1386">Build, load and run</a><ul><li class="level3"><a href="#autotoc_md1387">Sample Output</a></li>
<li class="level3"><a href="#autotoc_md1388">Test Case Description</a></li>
</ul>
</li>
</ul>
</li>
</ul>
</div>
<div class="textblock"><p><a class="anchor" id="md_examples_motorcontrol_tamagawa_example"></a></p>
<h1><a class="anchor" id="autotoc_md1381"></a>
Introduction</h1>
<p>Tamagawa diagnostic application does below,</p>
<p>Configures pinmux, GPIO, UART, ICSS clock to 200MHz, Initializes ICSS0-PRU1, Loads the initialization section of PRU firmware &amp; executes it. This application is controlled with a terminal interface using a serial over USB connection between the PC host and the EVM. Please connect a USB cable between the PC and the EVM. A serial terminal application (like teraterm/ hyperterminal/ minicom) is then run on the host. To configure, select the serial port corresponding to the port emulated over USB by the EVM. The host serial port should be configured to 115200 baud, no parity, 1 stop bit and no flow control. Connect the Tamagawa encoder via RS485 transceiver to the EVM. The connections between EVM and RS485 logic signals are:</p>
<p>PRU UART Rx -&gt; PRG0_PRU1_GPO9 PRU UART Tx -&gt; PRG0_PRU1_GPO10 Tx Enable -&gt; PRG0_PRU1_GPO0 It is necessary to provide 3.3V to the RS485 logic side. The receive transceiver is always kept enabled with bus side connected as in Tamagawa Specification.</p>
<p>The Tamagawa receiver firmware running on ICSS0-PRU1 provides a defined interface. The Tamagawa diagnostic application interacts with the Tamagawa receiver firmware interface. It then presents the user with menu options to select Data ID code (as defined by Tamagawa) to be sent to the encoder. The application collects the data entered by the user and configures the relevant interface. Then via the Tamagawa receiver interface, the command is triggered. Once the command completion is indicated by the interface, the status of the transaction is checked. If the Status indicates success, the result is presented to the user.</p>
<h1><a class="anchor" id="autotoc_md1382"></a>
Important files and directory structure</h1>
<table class="doxtable">
<tr>
<th>Folder/Files </th><th>Description  </th></tr>
<tr>
<td colspan="2" bgcolor="#F0F0F0">${SDK_INSTALL_PATH}/examples/motor_control/tamagawa_diagnostic </td></tr>
<tr>
<td>tamagawa_diagnostic.c </td><td>Tamagawa diagnostic application  </td></tr>
<tr>
<td colspan="2" bgcolor="#F0F0F0">${SDK_INSTALL_PATH}/source/motor_control/position_sense/tamagawa </td></tr>
<tr>
<td>firmware/ </td><td>Folder containing TAMAGAWA PRU firmware sources.  </td></tr>
</table>
<h1><a class="anchor" id="EXAMPLES_MOTORCONTROL_TAMAGAWA_COMBOS"></a>
Supported Combinations</h1>
<table class="markdownTable">
<tr class="markdownTableHead">
<th class="markdownTableHeadNone">Parameter  </th><th class="markdownTableHeadNone">Value   </th></tr>
<tr class="markdownTableRowOdd">
<td class="markdownTableBodyNone">CPU + OS  </td><td class="markdownTableBodyNone">r5fss0-0 freertos   </td></tr>
<tr class="markdownTableRowEven">
<td class="markdownTableBodyNone">ICSSG  </td><td class="markdownTableBodyNone">ICSSG0   </td></tr>
<tr class="markdownTableRowOdd">
<td class="markdownTableBodyNone">PRU  </td><td class="markdownTableBodyNone">PRU1   </td></tr>
<tr class="markdownTableRowEven">
<td class="markdownTableBodyNone">Toolchain  </td><td class="markdownTableBodyNone">ti-arm-clang   </td></tr>
<tr class="markdownTableRowOdd">
<td class="markdownTableBodyNone">Board  </td><td class="markdownTableBodyNone">am64x-evm   </td></tr>
<tr class="markdownTableRowEven">
<td class="markdownTableBodyNone">Example folder  </td><td class="markdownTableBodyNone">examples/motorcontrol/tamagawa_example   </td></tr>
</table>
<h1><a class="anchor" id="autotoc_md1383"></a>
Steps to Run the Example</h1>
<h2><a class="anchor" id="autotoc_md1384"></a>
Hardware Prerequisites</h2>
<ul>
<li>AM64x/AM243x EVM</li>
<li>Profibus AM64x Card</li>
<li>RS485 Half-duplex EVM</li>
<li>Tamagawa Encoder</li>
</ul>
<h2><a class="anchor" id="autotoc_md1385"></a>
Hardware Setup</h2>
<p> <style>div.image img[src="Tamagawa_setup.jpg"]{width:60%}</style> </p><div class="image">
<img src="Tamagawa_setup.jpg" alt=""/>
<div class="caption">
Hardware Setup</div></div>
<p> <style>div.image img[src="Tamagawa_Connections.png"]{width:60%}</style> </p><div class="image">
<img src="Tamagawa_Connections.png" alt=""/>
</div>
<h2><a class="anchor" id="autotoc_md1386"></a>
Build, load and run</h2>
<ul>
<li><b>When using CCS projects to build</b>, import the CCS project and build it using the CCS project menu (see <a class="el" href="CCS_PROJECTS_PAGE.html">Using SDK with CCS Projects</a>).</li>
<li><b>When using makefiles to build</b>, note the required combination and build using make command (see <a class="el" href="MAKEFILE_BUILD_PAGE.html">Using SDK with Makefiles</a>)</li>
<li>Launch a CCS debug session and run the executable, see <a class="el" href="CCS_LAUNCH_PAGE.html">CCS Launch, Load and Run</a></li>
<li>Refer to UART terminal for user interface menu options.</li>
</ul>
<h3><a class="anchor" id="autotoc_md1387"></a>
Sample Output</h3>
<p>Shown below is a sample output when the application is run:</p>
<p> <style>div.image img[src="Tamagawa_SampleOutput.png"]{width:60%}</style> </p><div class="image">
<img src="Tamagawa_SampleOutput.png" alt=""/>
<div class="caption">
Tamagawa Sample Output</div></div>
<h3><a class="anchor" id="autotoc_md1388"></a>
Test Case Description</h3>
<table class="doxtable">
<tr>
<th>Data_ID </th><th>Name </th><th>Description  </th></tr>
<tr>
<td>Data ID 0 </td><td>Data readout (absolute position data) </td><td>In this command we will receive: Absolute rotor position value in field name ABS.. Errors and warnings in field name SF(status field)   </td></tr>
<tr>
<td>Data ID 1 </td><td>Data readout (multi-turn data) </td><td>In this command we will receive data about: No. of rotor turns in field name ABM. Errors and warnings in field name SF(status field).   </td></tr>
<tr>
<td>Data ID 2 </td><td>Endoder-ID </td><td>In this command we will receive data about : Tamagawa encoder make-ID in ENID field . Errors and warnings in field name SF(status field)   </td></tr>
<tr>
<td>Data ID 3 </td><td>Data readout(absolute+multiturn+encoder-ID) </td><td>In this command we will receive : Absolute rotor position value in field name ABS. No. of rotor turns in field name ABM. Tamagawa encoder make-ID in ENID field . Errors and warnings in field name SF(status field) Other warnings in field name ALMC   </td></tr>
<tr>
<td>Data ID 5 </td><td>Reset-Error </td><td>This command used to reset errors.   </td></tr>
<tr>
<td>Data ID 6 </td><td>Reset- absolute </td><td>This command used to reset absolute position data(ABS)   </td></tr>
<tr>
<td>Data ID 7 </td><td>Reset- multiturn </td><td>This command used to reset multi-turn data(ABM)   </td></tr>
</table>
</div></div><!-- contents -->
</div><!-- PageDoc -->
</div><!-- doc-content -->
<!-- HTML footer for doxygen 1.8.11-->
<!-- start footer part -->
<div id="nav-path" class="navpath"><!-- id is needed for treeview function! -->
  <ul>
    <li class="footer">generated by
    <a href="http://www.doxygen.org/index.html">
    <img class="footer" src="doxygen.png" alt="doxygen"/></a> 1.8.20 </li>
  </ul>
</div>
</body>
</html>
